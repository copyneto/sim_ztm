sap.ui.define(["sap/ui/export/Spreadsheet","sap/ui/export/library"],function(e,a){"use strict";return sap.ui.controller("br.com.redesim.combinacaorecursos.ext.controller.ListReportExt",{onActionExportExcel:function(s){var t=[];var r="Modelo.xlsx";t.push(+
{label:"Recurso de combinação",property:"COMBINATION_RESOURCE_ID",type:a.EdmType.String});t.push({label:"Nº Seq.",property:"SEQ_NUM",type:a.EdmType.String});t.push({label:"Grupo de Veículos",property:"EQUI_TYPE",type:a.EdmType.String});t.push({label:"Tip+
o de veículo",property:"EQUI_CODE",type:a.EdmType.String});t.push({label:"Recurso",property:"RESOURCE_ID",type:a.EdmType.String});var o={workbook:{columns:t},dataSource:[""],count:1,fileName:r};var i=new e(o);i.build().finally(function(){i.destroy()})},o+
nActionUploadFile:function(){var e=this;var a=new sap.m.Dialog({contentWidth:"300px",resizable:true,type:"Message"});a.setTitle("Carregar arquivo Excel");var s="/sap/opu/odata/sap/ZTM_COMB_RECURSOS_SRV/";var t=new sap.ui.model.odata.ODataModel(s,false);v+
ar r=s+"UploadFileSet";var o=new sap.ui.unified.FileUploader({width:"100%",fileType:["xlsx","xls","csv"],typeMissmatch:this.handleTypeMissmatch});o.setName("Simple Uploader");o.setUploadUrl(r);o.setSendXHR(true);o.setUseMultipart(false);o.setUploadOnChan+
ge(false);var i=new sap.ui.unified.FileUploaderParameter({name:"x-csrf-token",value:t.getSecurityToken()});o.insertHeaderParameter(i);var n=new sap.m.Button({text:"Upload",type:"Accept",press:function(){var s=o.getFocusDomRef();var t=s.files[0];if(o.getV+
alue()===""){sap.m.MessageToast.show("Favor selecionar um arquivo");return}var r=new sap.ui.unified.FileUploaderParameter({name:"Content-Type",value:t.type});o.insertHeaderParameter(r);o.insertHeaderParameter(new sap.ui.unified.FileUploaderParameter({nam+
e:"SLUG",value:o.getValue()}));var i=function(s){return new Promise(function(s,t){o.attachUploadComplete(function(r){a.close();a.destroy();if(r.mParameters.status=="200"||r.mParameters.status=="201"||r.mParameters.status=="204"){s()}else{e.showLog(r.mPar+
ameters.responseRaw);t()}e.templateBaseExtension.getExtensionAPI().refreshTable()}.bind(this));o.upload()}.bind(this))}.bind(this);var n={sActionLabel:"Upload de Arquivo",dataloss:false};this.extensionAPI.securedExecution(i,n)}.bind(this)});var p=new sap+
.m.Button({text:"Cancelar",type:"Reject",press:function(){a.close();a.destroy();this.getView().removeAllDependents()}.bind(this)});a.addContent(o);a.setBeginButton(p);a.setEndButton(n);a.open()},handleTypeMissmatch:function(e){var a=e.getSource().getFile+
Type();jQuery.each(a,function(e,s){a[e]="*."+s});var s=a.join(", ");sap.m.MessageToast.show("Tipo de arquivo *."+e.getParameter("fileType")+" nao ? suportado. Escolha um dos tipos a seguir: "+s)},showLog:function(e){let a=[];for(const s of e.matchAll(/(?+
:<message>(.*?)<[/]message>)/gm)){a.push(s[1])}let s=[];for(const a of e.matchAll(/(?:<severity>(.*?)<[/]severity>)/gm)){switch(a[1]){case"error":s.push(sap.ui.core.MessageType.Error);break;case"info":s.push(sap.ui.core.MessageType.Information);break;cas+
e"success":s.push(sap.ui.core.MessageType.Success);break;case"warning":s.push(sap.ui.core.MessageType.Warning);break;default:s.push(sap.ui.core.MessageType.None);break}}for(let e=0;e<a.length;e++){if(a[e]=="Ocorreu uma exceção"){continue}sap.ui.getCore()+
.getMessageManager().addMessages(new sap.ui.core.message.Message({message:a[e],persistent:true,type:s[e]}))}}})});                                                                                                                                             
//# sourceMappingURL=ListReportExt.controller.js.map                                                                                                                                                                                                           